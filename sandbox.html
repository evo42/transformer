<!doctype html>
<head>
	<title>Transformer &bull; sandbox</title>
	<meta charset="UTF-8">
	<link href="transformer.css" type="text/css" rel="stylesheet" />
	<style> 
		body {
			padding: 0;
			margin: 0;
		}
		.box {
			border: 2px solid rgba(0,0,0,0.8);
			position: absolute;
			text-align: left;
			word-wrap: break-word;
			/* -webkit-user-modify: read-write; */
			-webkit-nbsp-mode: space;
			-webkit-line-break: after-white-space	
		}
	</style>
</head>
<body>
	<pre>
	   New box : SHIFT; DRAG
	Rotate box : CTRL; DRAG
	</pre>

	<script src="vendor/jquery.js"></script>
	<!-- script src="vendor/jquery-ui.js"></script -->
	<script src="vendor/mandox/esprima.js"></script>
	<script src="vendor/mandox/stacktrace.js"></script>
	<script src="vendor/mandox/mandox.js"></script>
	<script src="transformer.js"></script>
	<script>
		(function ($) {
			var rotation = null;
			var creating = null;

			function createBox(css) {
				var $box = $('<div class="box">This way up</div>').appendTo('body');
				$box.css('position', 'absolute').css(css);
				return {
					$box : $box,
					left : css.left,
					top  : css.top
				};
			}

			$(document).on('mousemove', function onmousemove($event) {
				if (creating) {
					creating.$box.width($event.pageX - creating.left);
					creating.$box.height($event.pageY - creating.top);
				}
				if (rotation) {
					Transformer.updateRotation(
						rotation,
						$event.pageX,
						$event.pageY
					);
				}
			}).on('mousedown', function onmousedown($event) {
				if ($event.shiftKey) {
					Transformer.disableSelection($('body'));
					creating = createBox({
						left: $event.pageX,
						top: $event.pageY,
					});
				}
			}).on('mouseup', function onmouseup($event) {
				Transformer.enableSelection($('body'));
				if (rotation) {
					Transformer.endRotation(rotation);
					rotation = null;
				}
				if (creating) {
					creating = null;
				}
			}).on('mousedown', '.box', function onboxmousedown($event) {
				if ($event.ctrlKey) {
					rotation = Transformer.startRotation(
						$event.target,
						$event.pageX,
						$event.pageY
					);
				}
			});
		}(jQuery));
	</script>
</body>
</html>
